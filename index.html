<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Car Goal</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Копилка">
    
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body { 
            background-color: #0b0b0b; 
            color: white; 
            font-family: 'Inter', sans-serif; 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
            margin: 0;
            padding-top: env(safe-area-inset-top); /* Отступ для челки iPhone */
        }
        
        .target-title { font-weight: 900; font-style: italic; text-align: center; transition: all 0.5s ease; }
        .style-normal { color: #ff3b30; text-shadow: 0 0 25px rgba(255, 59, 48, 0.6); font-size: 3.5rem; }
        .style-urgent { color: #ffcc00; text-shadow: 0 0 30px rgba(255, 204, 0, 0.7); font-size: 2.1rem; animation: pulse 1.5s infinite; }
        
        @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.7; transform: scale(0.95); } }

        .car-mask { 
            position: relative; width: 90%; height: 240px; 
            -webkit-mask-image: url('car-outline.png'); mask-image: url('car-outline.png'); 
            -webkit-mask-size: contain; mask-size: contain; 
            -webkit-mask-repeat: no-repeat; -webkit-mask-position: center; 
            background: rgba(255, 255, 255, 0.05); 
        }
        .liquid-fill { 
            position: absolute; bottom: 0; width: 100%; height: 0%; 
            background: linear-gradient(180deg, #007AFF 0%, #00f2ff 100%); 
            transition: height 2s cubic-bezier(0.4, 0, 0.2, 1); 
            box-shadow: 0 0 40px rgba(0, 122, 255, 0.5); 
        }

        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        
        /* Кнопка пополнения с эффектом нажатия */
        .btn-pay:active { transform: scale(0.98); background-color: #0056b3; }
    </style>
</head>
<body>

    <div id="mainTitle" onclick="handleSecretReset()" class="target-title style-normal mt-10 uppercase cursor-pointer">500 000!</div>
    <p id="remainingLabel" class="text-center text-gray-500 text-[10px] font-black tracking-[0.3em] uppercase mt-2">ОСТАЛОСЬ ОЧЕНЬ МНОГО</p>

    <div class="flex-grow flex items-center justify-center relative" onclick="handleCarClick()">
        <div class="car-mask">
            <div id="paintLevel" class="liquid-fill"></div>
        </div>
        <img src="car-outline.png" class="absolute pointer-events-none opacity-20 w-[90%] h-full object-contain">
    </div>

    <div class="p-6 space-y-4 bg-white/5 backdrop-blur-xl rounded-t-[40px] border-t border-white/10 pb-10">
        <input type="number" id="sumInput" pattern="\d*" inputmode="decimal" placeholder="СУММА ПОПОЛНЕНИЯ ₸" class="w-full bg-black/50 border border-white/10 rounded-2xl py-4 text-center text-xl font-bold outline-none text-white focus:border-blue-500">
        <button onclick="doPayment()" class="btn-pay w-full py-4 rounded-2xl font-black bg-blue-600 text-white uppercase tracking-widest text-sm transition-all">ПОПОЛНИТЬ</button>
        
        <div class="grid grid-cols-5 gap-1 opacity-40 mt-2">
            <div class="text-[8px] font-black text-center text-blue-400">ЯНВ</div>
            <div class="text-[8px] font-black text-center">ФЕВ</div>
            <div class="text-[8px] font-black text-center">МАР</div>
            <div class="text-[8px] font-black text-center">АПР</div>
            <div class="text-[8px] font-black text-center">МАЙ</div>
        </div>
    </div>

    <script>
        const GOAL = 500000;
        let currentTotal = 0;

        // Загрузка данных из памяти браузера
        function loadData() {
            const saved = localStorage.getItem('local_car_total');
            if (saved) {
                currentTotal = parseFloat(saved);
                refreshUI();
            }
        }

        function doPayment() {
            const input = document.getElementById('sumInput');
            const amt = parseFloat(input.value);
            if (!amt || amt <= 0) return;

            currentTotal += amt;
            localStorage.setItem('local_car_total', currentTotal);
            
            refreshUI();
            input.value = "";
            input.blur(); // Скрыть клавиатуру
        }

        function refreshUI() {
            const fillPercent = Math.min((currentTotal / GOAL) * 100, 100);
            document.getElementById('paintLevel').style.height = fillPercent + '%';
            updateHeader();
        }

        function updateHeader() {
            const day = new Date().getDate();
            const title = document.getElementById('mainTitle');
            if (day === 30) {
                title.innerText = "ОПЛАТИТЕ СУММУ!";
                title.className = "target-title style-urgent mt-10 uppercase cursor-pointer";
            } else {
                title.innerText = "500 000!";
                title.className = "target-title style-normal mt-10 uppercase cursor-pointer";
            }
        }

        let carClicks = 0;
        function handleCarClick() {
            carClicks++;
            setTimeout(() => carClicks = 0, 1000);
            if (carClicks === 4) {
                const label = document.getElementById('remainingLabel');
                const rem = GOAL - currentTotal;
                label.innerText = `ОСТАЛОСЬ: ${rem > 0 ? rem.toLocaleString() : 0} ₸`;
                label.classList.replace('text-gray-500', 'text-blue-400');
                setTimeout(() => {
                    label.innerText = "ОСТАЛОСЬ ОЧЕНЬ МНОГО";
                    label.classList.replace('text-blue-400', 'text-gray-500');
                }, 3000);
            }
        }

        let resetClicks = 0;
        function handleSecretReset() {
            resetClicks++;
            setTimeout(() => resetClicks = 0, 1500);
            if (resetClicks === 5) {
                if (confirm("Сбросить весь прогресс в памяти этого телефона?")) {
                    currentTotal = 0;
                    localStorage.setItem('local_car_total', 0);
                    refreshUI();
                }
            }
        }

        window.onload = loadData;
    </script>
</body>
</html>
