<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Tracker Final</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #0b0b0b;
            color: white;
            font-family: 'Inter', sans-serif;
            margin: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .target-title {
            font-weight: 900;
            font-style: italic;
            line-height: 1;
            text-align: center;
            transition: all 0.5s ease;
        }

        .style-normal {
            color: #ff3b30;
            text-shadow: 0 0 25px rgba(255, 59, 48, 0.6);
            font-size: 3.5rem;
        }

        .style-urgent {
            color: #ffcc00;
            text-shadow: 0 0 30px rgba(255, 204, 0, 0.7);
            font-size: 2.2rem;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(0.95); }
        }

        .paint-container {
            position: relative;
            width: 100%;
            height: 240px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 15px 0;
        }

        .car-mask {
            position: relative;
            width: 90%;
            height: 100%;
            -webkit-mask-image: url('car-outline.png');
            mask-image: url('car-outline.png');
            -webkit-mask-size: contain;
            mask-size: contain;
            -webkit-mask-repeat: no-repeat;
            mask-repeat: no-repeat;
            -webkit-mask-position: center;
            background: rgba(255, 255, 255, 0.05);
        }

        .liquid-fill {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 0%;
            background: linear-gradient(180deg, #007AFF 0%, #00f2ff 100%);
            transition: height 2s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 40px rgba(0, 122, 255, 0.5);
        }

        .glass-ui {
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 30px;
            padding: 20px;
            margin: 0 20px 20px 20px;
        }

        .btn-active {
            background: #007AFF !important;
            color: white !important;
            box-shadow: 0 0 20px rgba(0, 122, 255, 0.4);
            cursor: pointer !important;
        }
    </style>
</head>
<body>

    <div id="mainTitle" onclick="handleSecretClick()" class="target-title style-normal mt-10 uppercase cursor-pointer">500 000!</div>
    
    <p id="remainingLabel" class="text-center text-gray-500 text-[10px] font-black tracking-[0.3em] uppercase mt-2">
        –û–°–¢–ê–õ–û–°–¨: 500 000 ‚Ç∏
    </p>

    <div class="paint-container">
        <div class="car-mask">
            <div id="paintLevel" class="liquid-fill"></div>
        </div>
        <img src="car-outline.png" class="absolute pointer-events-none opacity-20 w-[90%] h-full object-contain">
    </div>

    <div class="glass-ui space-y-4">
        <input type="number" id="sumInput" placeholder="–°–£–ú–ú–ê –ü–û–ü–û–õ–ù–ï–ù–ò–Ø ‚Ç∏" 
            class="w-full bg-black/50 border border-white/10 rounded-2xl py-4 text-center text-lg font-bold outline-none focus:border-blue-500 transition-all text-white">
        
        <input type="file" id="fileField" class="hidden" onchange="enableButton()">
        <label for="fileField" id="fileStatus" class="flex items-center justify-center gap-2 w-full py-3 border border-dashed border-gray-700 rounded-2xl text-gray-500 text-[10px] font-bold cursor-pointer hover:border-blue-500 transition-all uppercase">
            <span>üìé –ü–†–ò–ö–†–ï–ü–ò–¢–¨ –ß–ï–ö</span>
        </label>

        <button id="submitBtn" onclick="doPayment()" disabled class="w-full py-4 rounded-2xl font-black uppercase tracking-widest text-xs bg-[#1a1a1a] text-[#444] cursor-not-allowed transition-all">
            –ü–û–ü–û–õ–ù–ò–¢–¨ –ö–û–ü–ò–õ–ö–£
        </button>
    </div>

    <div class="flex justify-between px-10 mb-8 mt-auto opacity-40">
        <span class="text-[9px] font-black text-blue-500 border-b-2 border-blue-500 pb-1">–Ø–ù–í</span>
        <span class="text-[9px] font-black text-gray-600">–§–ï–í</span>
        <span class="text-[9px] font-black text-gray-700">–ú–ê–†</span>
        <span class="text-[9px] font-black text-gray-800">–ê–ü–†</span>
    </div>

    <script>
        const GOAL = 500000;
        let currentTotal = 0;
        let clickCount = 0;
        let clickTimer;

        window.onload = () => {
            updateHeader();
            loadData();
            if (window.Telegram?.WebApp) {
                window.Telegram.WebApp.expand(); // –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω –≤ TG
            }
        };

        // –°–µ–∫—Ä–µ—Ç–Ω—ã–π —Å–±—Ä–æ—Å (5 –∫–ª–∏–∫–æ–≤)
        function handleSecretClick() {
            clickCount++;
            clearTimeout(clickTimer);
            clickTimer = setTimeout(() => { clickCount = 0; }, 1500);

            if (clickCount === 5) {
                if (confirm("–û–ë–ù–£–õ–ò–¢–¨ –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å?")) {
                    currentTotal = 0;
                    localStorage.removeItem('totalSaved');
                    if (window.Telegram?.WebApp?.CloudStorage) {
                        window.Telegram.WebApp.CloudStorage.removeItem('totalSaved');
                    }
                    refreshUI();
                }
                clickCount = 0;
            }
        }

        function updateHeader() {
            const day = new Date().getDate();
            const title = document.getElementById('mainTitle');
            if (day === 30) {
                title.innerText = "–û–ü–õ–ê–¢–ò–¢–ï –°–£–ú–ú–£!";
                title.className = "target-title style-urgent mt-10 uppercase cursor-pointer";
            } else {
                title.innerText = "500 000!";
                title.className = "target-title style-normal mt-10 uppercase cursor-pointer";
            }
        }

        function loadData() {
            const localValue = localStorage.getItem('totalSaved');
            if (localValue) {
                currentTotal = parseFloat(localValue);
                refreshUI();
            }
            if (window.Telegram?.WebApp?.CloudStorage) {
                window.Telegram.WebApp.CloudStorage.getItem('totalSaved', (err, val) => {
                    if (!err && val) {
                        currentTotal = parseFloat(val);
                        refreshUI();
                    }
                });
            }
        }

        function enableButton() {
            const btn = document.getElementById('submitBtn');
            const label = document.getElementById('fileStatus');
            btn.disabled = false;
            btn.classList.add('btn-active');
            label.innerHTML = "‚úÖ –ß–ï–ö –ó–ê–ì–†–£–ñ–ï–ù";
            label.classList.add('text-blue-400', 'border-blue-400');
        }

        function doPayment() {
            const amt = parseFloat(document.getElementById('sumInput').value);
            if (!amt || amt <= 0) return;

            currentTotal += amt;
            localStorage.setItem('totalSaved', currentTotal);
            if (window.Telegram?.WebApp?.CloudStorage) {
                window.Telegram.WebApp.CloudStorage.setItem('totalSaved', currentTotal.toString());
            }

            refreshUI();
            clearForm();

            if (window.Telegram?.WebApp) {
                window.Telegram.WebApp.HapticFeedback.notificationOccurred('success');
            }
        }

        function refreshUI() {
            const remaining = Math.max(GOAL - currentTotal, 0);
            document.getElementById('remainingLabel').innerText = `–û–°–¢–ê–õ–û–°–¨: ${remaining.toLocaleString()} ‚Ç∏`;
            const fillPercent = Math.min((currentTotal / GOAL) * 100, 100);
            document.getElementById('paintLevel').style.height = fillPercent + '%';
        }

        function clearForm() {
            document.getElementById('sumInput').value = "";
            document.getElementById('fileField').value = "";
            const btn = document.getElementById('submitBtn');
            btn.disabled = true;
            btn.className = "w-full py-4 rounded-2xl font-black uppercase tracking-widest text-xs bg-[#1a1a1a] text-[#444] cursor-not-allowed transition-all";
            const label = document.getElementById('fileStatus');
            label.innerHTML = "üìé –ü–†–ò–ö–†–ï–ü–ò–¢–¨ –ß–ï–ö";
            label.className = "flex items-center justify-center gap-2 w-full py-3 border border-dashed border-gray-700 rounded-2xl text-gray-500 text-[10px] font-bold cursor-pointer hover:border-blue-500 transition-all uppercase";
        }
    </script>
</body>
</html>
